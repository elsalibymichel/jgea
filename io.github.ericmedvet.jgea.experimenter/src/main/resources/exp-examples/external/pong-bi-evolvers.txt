@import("import/pong-environment.txt")
@import("import/shared-misc.txt")
@import("import/descriptors.txt")
@import("import/listeners.txt")

ea.experiment(
  runs =
    (randomGenerator = (seed = $SEEDS) * [m.defaultRG()]) *
    (solver = (stop = [ea.sc.nOfQualityEvaluations(n = $N_EVALS)]) *
    (fitnessReducer = [ea.misc.lossyAverage()]) * (opponentsSelector = (nOfOpponents = [1; 2; 3]) * [ea.misc.nearestMESelector(); ea.misc.randomSelector(); ea.misc.farthestMESelector(); ea.misc.bestSelector(); ea.misc.oldestSelector()]) * (emptyArchive = [false]) * [
      ea.s.biMapElites(
        name = "bi-me-tree";
        representation = ea.r.srTree();
        mapper = ea.m.nurfToNds(of = ea.m.srTreeToNurf());
        descriptors = $TREE_DESCRIPTOR;
        fitnessAggregator = f.avg()
      );
      ea.s.biMapElites(
        name = "bi-me-ann";
        representation = ea.r.doubleString();
        mapper = ea.m.dsToNpnds(npnds = $MLP);
        descriptors = $ANN_DESCRIPTORS;
        fitnessAggregator = f.avg()
      )
    ] + [
      ea.s.ga(
        name = "self-ga-tree";
        representation = ea.r.srTree();
        mapper = ea.m.nurfToNds(of = ea.m.srTreeToNurf())
      );
      ea.s.ga(
        name = "self-ga-ann";
        representation = ea.r.doubleString();
        mapper = ea.m.dsToNpnds(npnds = $MLP)
      );

      ea.s.mapElites(
        name = "self-me-ann";
        representation = ea.r.doubleString();
        mapper = ea.m.dsToNpnds(npnds = $MLP);
        descriptors = $ANN_DESCRIPTORS
      );
      ea.s.mapElites(
        name = "self-me-tree";
        representation = ea.r.srTree();
        mapper = ea.m.nurfToNds(of = ea.m.srTreeToNurf());
        descriptors = $TREE_DESCRIPTOR
      )
    ] + (fitnessReducer = [ea.misc.lossyAverage()]) * (opponentsSelector = (nOfOpponents = [1; 2; 3]) *
    [ea.misc.randomSelector(); ea.misc.bestSelector(); ea.misc.oldestSelector()]) * [
      ea.s.biGa(
        name = "bi-ga-ann";
        representation = ea.r.doubleString();
        mapper = ea.m.dsToNpnds(npnds = $MLP);
        fitnessAggregator = f.avg()
      );
      ea.s.biGa(
        name = "bi-ga-tree";
        representation = ea.r.srTree();
        mapper = ea.m.nurfToNds(of = ea.m.srTreeToNurf());
        fitnessAggregator = f.avg()
      )
    ]) *
    (problem = [ea.p.biSimToBiTo(
      simulation = $SIMULATION;
      qFunction1 = $QUALITY_F1;
      qFunction2 = $QUALITY_F2;
      tRange = misc.range(min = 0; max = 45);
      dT = 0.05;
      type = maximize
    )]) *
    [ea.run()];

  listeners = $GENERAL_LISTENERS + $PONG_LISTENERS
)